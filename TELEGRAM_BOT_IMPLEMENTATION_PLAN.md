# Telegram Bot - –ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–ü—Ä–æ–µ–∫—Ç: –¢–µ—Ö–Ω–æ–ú–æ–¥–µ—Ä–Ω
claude
–¶–µ–ª—å: –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ Telegram –±–æ—Ç–∞ –¥–ª—è –ø—Ä–∏—ë–º–∞ –∑–∞—è–≤–æ–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–æ–º

---

## –§–ê–ó–ê 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1.1 –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É admin_users
```sql
- id (UUID)
- telegram_id (BIGINT) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram
- telegram_username (VARCHAR)
- role (VARCHAR) - 'superadmin', 'admin', 'manager'
- permissions (JSONB) - –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- created_at, updated_at
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤

### 1.2 –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É bot_states
```sql
- id (UUID)
- telegram_id (BIGINT)
- state (VARCHAR) - 'idle', 'adding_product', 'creating_order'
- step (VARCHAR) - —Ç–µ–∫—É—â–∏–π —à–∞–≥ –≤ –¥–∏–∞–ª–æ–≥–µ
- data (JSONB) - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∞
- expires_at (TIMESTAMPTZ)
- created_at, updated_at
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è multi-step –¥–∏–∞–ª–æ–≥–æ–≤

### 1.3 –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É orders
```sql
- –î–æ–±–∞–≤–∏—Ç—å telegram_user_id (BIGINT)
- –î–æ–±–∞–≤–∏—Ç—å assigned_admin_id (UUID)
- –î–æ–±–∞–≤–∏—Ç—å notes (TEXT) - –∑–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∞
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–≤—è–∑—å –∑–∞—è–≤–æ–∫ —Å Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### 1.4 –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞
```sql
INSERT INTO admin_users (telegram_id, telegram_username, role)
VALUES (YOUR_TELEGRAM_ID, 'your_username', 'superadmin');
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–µ—Ä–≤—ã–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∞–¥–º–∏–Ω

---

## –§–ê–ó–ê 2: –°–æ–∑–¥–∞–Ω–∏–µ Edge Function

### 2.1 –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É Edge Function
```
supabase/functions/telegram-bot/
‚îú‚îÄ‚îÄ index.ts          # –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ start.ts      # /start
‚îÇ   ‚îú‚îÄ‚îÄ help.ts       # /help
‚îÇ   ‚îú‚îÄ‚îÄ orders.ts     # /orders (admin)
‚îÇ   ‚îú‚îÄ‚îÄ add-product.ts # /add_product (admin)
‚îÇ   ‚îú‚îÄ‚îÄ catalog.ts    # /catalog
‚îÇ   ‚îî‚îÄ‚îÄ order.ts      # /order (client)
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ callback.ts   # Inline –∫–Ω–æ–ø–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ message.ts    # –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ photo.ts      # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ telegram.ts   # API –º–µ—Ç–æ–¥—ã Telegram
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ state.ts      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
‚îÇ   ‚îî‚îÄ‚îÄ keyboards.ts  # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∫–Ω–æ–ø–∫–∏
‚îî‚îÄ‚îÄ types.ts          # TypeScript —Ç–∏–ø—ã
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –±–æ—Ç–∞

### 2.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
```typescript
// index.ts
- –ü–æ–ª—É—á–µ–Ω–∏–µ webhook update –æ—Ç Telegram
- –†–æ—É—Ç–∏–Ω–≥ –ø–æ —Ç–∏–ø—É update (message, callback_query)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### 2.3 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É—Ç–∏–ª–∏—Ç—ã Telegram API
```typescript
// utils/telegram.ts
- sendMessage(chatId, text, options)
- editMessage(chatId, messageId, text, options)
- answerCallbackQuery(callbackId, text)
- sendPhoto(chatId, photo, caption)
- deleteMessage(chatId, messageId)
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±—ë—Ä—Ç–∫–∏ –¥–ª—è Telegram API

### 2.4 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–¥–º–∏–Ω–∞
```typescript
// utils/auth.ts
- isAdmin(telegramId) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ admin_users
- getAdminPermissions(telegramId)
- requireAdmin(telegramId) - throw –µ—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥

### 2.5 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
```typescript
// utils/state.ts
- getState(telegramId)
- setState(telegramId, state, step, data)
- clearState(telegramId)
- isExpired(state)
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Multi-step –¥–∏–∞–ª–æ–≥–∏

---

## –§–ê–ó–ê 3: –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### 3.1 –ö–æ–º–∞–Ω–¥–∞ /start
```
–õ–æ–≥–∏–∫–∞:
1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ - –∞–¥–º–∏–Ω –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç
3. –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –º–µ–Ω—é

–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞:
- –ö–Ω–æ–ø–∫–∞ "–ö–∞—Ç–∞–ª–æ–≥"
- –ö–Ω–æ–ø–∫–∞ "–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"
- –ö–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏"

–î–ª—è –∞–¥–º–∏–Ω–∞:
- –ö–Ω–æ–ø–∫–∞ "–ó–∞—è–≤–∫–∏"
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"
- –ö–Ω–æ–ø–∫–∞ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –º–µ–Ω—é

### 3.2 –ö–æ–º–∞–Ω–¥–∞ /help
```
–õ–æ–≥–∏–∫–∞:
1. –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
2. –†–∞–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –∞–¥–º–∏–Ω–∞/–∫–ª–∏–µ–Ω—Ç–∞
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

### 3.3 –ö–æ–º–∞–Ω–¥–∞ /catalog
```
–õ–æ–≥–∏–∫–∞:
1. –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (inline –∫–Ω–æ–ø–∫–∏)
2. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
3. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–æ–≤–∞—Ä–∞ - –∫–∞—Ä—Ç–æ—á–∫–∞ —Å —Ü–µ–Ω–æ–π –∏ –∫–Ω–æ–ø–∫–æ–π "–ó–∞–∫–∞–∑–∞—Ç—å"
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ –±–æ—Ç–µ

---

## –§–ê–ó–ê 4: –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

### 4.1 –ö–æ–º–∞–Ω–¥–∞ /orders
```
–õ–æ–≥–∏–∫–∞:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –∞–¥–º–∏–Ω
2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 'new'
3. –ü–æ–∫–∞–∑–∞—Ç—å –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –∫–∞–∂–¥–æ–π
4. Inline –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π

–§–æ—Ä–º–∞—Ç:
üìã –ù–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ (5)

#12345 - –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤
üì¶ –ù–æ—É—Ç–±—É–∫ MSI
üìû +7 999 123-45-67
[–ü–æ–¥—Ä–æ–±–Ω–µ–µ] [‚úÖ –í–∑—è—Ç—å]
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 4.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–∫–∏ (inline –∫–Ω–æ–ø–∫–∏)
```
–ö–Ω–æ–ø–∫–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ –æ –∑–∞—è–≤–∫–µ:
- "‚úÖ –ü—Ä–∏–Ω—è—Ç—å" ‚Üí —Å—Ç–∞—Ç—É—Å = 'processing', –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∞
- "‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å" ‚Üí —Å—Ç–∞—Ç—É—Å = 'cancelled', –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É
- "üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å" ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- "üí¨ –ù–∞–ø–∏—Å–∞—Ç—å" ‚Üí –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç —Å –∫–ª–∏–µ–Ω—Ç–æ–º (–µ—Å–ª–∏ –µ—Å—Ç—å telegram)
- "‚úîÔ∏è –ó–∞–≤–µ—Ä—à–∏—Ç—å" ‚Üí —Å—Ç–∞—Ç—É—Å = 'completed'
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –∑–∞—è–≤–∫–∞–º–∏

### 4.3 –ö–æ–º–∞–Ω–¥–∞ /add_product (multi-step)
```
–®–∞–≥–∏ –¥–∏–∞–ª–æ–≥–∞:
1. "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:"
2. "–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:" (inline –∫–Ω–æ–ø–∫–∏)
3. "–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –≤ —Ä—É–±–ª—è—Ö:"
4. "–í–≤–µ–¥–∏—Ç–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑:"
5. "–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞:"
6. "–î–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ? (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)"
7. –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–≤—å—é –∏ –∫–Ω–æ–ø–∫–∏ [‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]

–°–æ—Å—Ç–æ—è–Ω–∏–µ:
state: 'adding_product'
step: 'name' | 'category' | 'price' | 'min_order' | 'photo' | 'description' | 'confirm'
data: { name, category, price, ... }
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

### 4.4 –ö–æ–º–∞–Ω–¥–∞ /stats
```
–õ–æ–≥–∏–∫–∞:
1. –ó–∞—è–≤–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è/–Ω–µ–¥–µ–ª—é/–º–µ—Å—è—Ü
2. –ü–æ —Å—Ç–∞—Ç—É—Å–∞–º (new, processing, completed)
3. –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π
4. –ö–æ–Ω–≤–µ—Ä—Å–∏—è

–§–æ—Ä–º–∞—Ç:
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–°–µ–≥–æ–¥–Ω—è: 5 –∑–∞—è–≤–æ–∫
–ù–µ–¥–µ–ª—è: 23 –∑–∞—è–≤–∫–∏
–ú–µ—Å—è—Ü: 89 –∑–∞—è–≤–æ–∫

–ü–æ —Å—Ç–∞—Ç—É—Å–∞–º:
üÜï –ù–æ–≤—ã–µ: 3
‚è≥ –í —Ä–∞–±–æ—Ç–µ: 7
‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω—ã: 79

–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
1. –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ (34)
2. –ú–µ–±–µ–ª—å (21)
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞

---

## –§–ê–ó–ê 5: –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 5.1 –ö–æ–º–∞–Ω–¥–∞ /order (multi-step)
```
–®–∞–≥–∏ –¥–∏–∞–ª–æ–≥–∞:
1. "–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?"
2. "–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:"
3. "–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å? (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏–ª–∏ —Å—Å—ã–ª–∫–∞)"
4. "–£–∫–∞–∂–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:"
5. "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è? (–º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)"
6. –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–≤—å—é –∏ [‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏:
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ orders —Å source='telegram_bot'
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º
- –ü–æ–∫–∞–∑–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É "–ó–∞—è–≤–∫–∞ #XXX –ø—Ä–∏–Ω—è—Ç–∞!"
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏—ë–º –∑–∞—è–≤–æ–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞

### 5.2 –ó–∞–∫–∞–∑ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
```
–õ–æ–≥–∏–∫–∞:
1. –í –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞ –∫–Ω–æ–ø–∫–∞ "–ó–∞–∫–∞–∑–∞—Ç—å"
2. –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–∞–∫—Ç—ã (—Ç–æ–≤–∞—Ä —É–∂–µ –∏–∑–≤–µ—Å—Ç–µ–Ω)
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å product_id
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë—ã—Å—Ç—Ä—ã–π –∑–∞–∫–∞–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

### 5.3 –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—É
```
–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç—É –∫–æ–≥–¥–∞:
- –ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –≤ —Ä–∞–±–æ—Ç—É
- –ó–∞—è–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- –ó–∞–ø—Ä–æ—Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

–§–æ—Ä–º–∞—Ç:
üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –∑–∞—è–≤–∫–µ #12345

–°—Ç–∞—Ç—É—Å: –í —Ä–∞–±–æ—Ç–µ ‚è≥
–ú–µ–Ω–µ–¥–∂–µ—Ä: –ê–ª–µ–∫—Å–µ–π

–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–ª–∏–µ–Ω—Ç –≤ –∫—É—Ä—Å–µ —Å—Ç–∞—Ç—É—Å–∞

---

## –§–ê–ó–ê 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### 6.1 –û–±–Ω–æ–≤–∏—Ç—å /api/orders/submit
```typescript
- –î–æ–±–∞–≤–∏—Ç—å inline –∫–Ω–æ–ø–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å message_id –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–Ω–æ–ø–∫–∏ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö —Å —Å–∞–π—Ç–∞

### 6.2 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
```typescript
–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤ –ë–î:
- –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram (editMessage)
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É (–µ—Å–ª–∏ –µ—Å—Ç—å telegram_id)
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤–µ–∑–¥–µ

---

## –§–ê–ó–ê 7: –î–µ–ø–ª–æ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 7.1 –î–µ–ø–ª–æ–π Edge Function
```bash
supabase functions deploy telegram-bot
```

### 7.2 –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook
```bash
curl -X POST "https://api.telegram.org/bot<TOKEN>/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://<PROJECT>.supabase.co/functions/v1/telegram-bot"}'
```

### 7.3 –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
```bash
curl -X POST "https://api.telegram.org/bot<TOKEN>/setMyCommands" \
  -H "Content-Type: application/json" \
  -d '{
    "commands": [
      {"command": "start", "description": "–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É"},
      {"command": "help", "description": "–ü–æ–º–æ—â—å"},
      {"command": "catalog", "description": "–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤"},
      {"command": "order", "description": "–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É"},
      {"command": "orders", "description": "–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ (–∞–¥–º–∏–Ω)"},
      {"command": "add_product", "description": "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä (–∞–¥–º–∏–Ω)"},
      {"command": "stats", "description": "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∞–¥–º–∏–Ω)"}
    ]
  }'
```

### 7.4 –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã
```bash
supabase secrets set TELEGRAM_BOT_TOKEN=<token>
supabase secrets set SUPABASE_URL=<url>
supabase secrets set SUPABASE_SERVICE_KEY=<key>
```

---

## –§–ê–ó–ê 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 8.1 –¢–µ—Å—Ç –±–∞–∑–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
- [ ] /start –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é
- [ ] /help –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É
- [ ] /catalog –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### 8.2 –¢–µ—Å—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] /orders –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞—è–≤–∫–∏
- [ ] Inline –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] /add_product —Å–æ–∑–¥–∞—ë—Ç —Ç–æ–≤–∞—Ä
- [ ] /stats –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### 8.3 –¢–µ—Å—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
- [ ] /order —Å–æ–∑–¥–∞—ë—Ç –∑–∞—è–≤–∫—É
- [ ] –ó–∞—è–≤–∫–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∞–¥–º–∏–Ω—É
- [ ] –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 8.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –ó–∞—è–≤–∫–∞ —Å —Å–∞–π—Ç–∞ ‚Üí Telegram —Å –∫–Ω–æ–ø–∫–∞–º–∏
- [ ] –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –¢–æ–≤–∞—Ä —á–µ—Ä–µ–∑ –±–æ—Ç–∞ ‚Üí –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ

---

## –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

1. **–î–µ–Ω—å 1:** –§–∞–∑–∞ 1 (–ë–î) + –§–∞–∑–∞ 2.1-2.5 (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
2. **–î–µ–Ω—å 2:** –§–∞–∑–∞ 3 (–±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã)
3. **–î–µ–Ω—å 3:** –§–∞–∑–∞ 4.1-4.2 (–∑–∞—è–≤–∫–∏ + –∫–Ω–æ–ø–∫–∏)
4. **–î–µ–Ω—å 4:** –§–∞–∑–∞ 4.3-4.4 (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
5. **–î–µ–Ω—å 5:** –§–∞–∑–∞ 5 (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏)
6. **–î–µ–Ω—å 6:** –§–∞–∑–∞ 6 (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞)
7. **–î–µ–Ω—å 7:** –§–∞–∑–∞ 7-8 (–¥–µ–ø–ª–æ–π + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Telegram
TELEGRAM_BOT_TOKEN=8551072778:AAGdeTxdhZV1ESdzpsNLtTThY2sLecfoNos
TELEGRAM_ADMIN_CHAT_ID=<ID –≥—Ä—É–ø–ø—ã –∞–¥–º–∏–Ω–æ–≤>

# Supabase (–¥–ª—è Edge Function)
SUPABASE_URL=https://rbngpxwamfkunktxjtqh.supabase.co
SUPABASE_SERVICE_KEY=<service_role key>
```

---

## –ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

–°–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –∏ –ø–æ–ø—Ä–æ—Å–∏:

```
–ù–∞—á–Ω–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Telegram –±–æ—Ç–∞ –ø–æ –ø–ª–∞–Ω—É TELEGRAM_BOT_IMPLEMENTATION_PLAN.md

–ù–∞—á–Ω–∏ —Å –§–∞–∑—ã 1 - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
–ò—Å–ø–æ–ª—å–∑—É–π MCP –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã Supabase –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π.
```
