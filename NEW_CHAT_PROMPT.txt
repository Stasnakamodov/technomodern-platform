## Задача: Перепроверка аудита релевантности товаров в категориях

### Контекст
Предыдущий агент провёл аудит 12 категорий и переместил ~101 товар.
Твоя задача - ПЕРЕПРОВЕРИТЬ его работу и найти пропущенные ошибки.

### Что было сделано предыдущим агентом:
- Проверено 12 категорий
- Перемещено 101 товар
- Основные находки:
  - "Средства гигиены": 73 книги о продукт-менеджменте (79% мусора!)
  - "Смартфоны и планшеты": 26 мышей/клавиатур/веб-камер
  - "Краски и лаки": 12 товаров (электрика, инструменты)
  - "Текстиль": 5 товаров (инструменты, мебель)

### Категории для ПЕРЕПРОВЕРКИ (с текущим количеством товаров):
1. Средства гигиены (15) - осталось после чистки
2. Строительные материалы (22)
3. Одежда оптом (36)
4. Посуда (41)
5. Сантехника (50)
6. Автозапчасти (57)
7. Смартфоны и планшеты (57)
8. Краски и лаки (67)
9. Текстиль (75)
10. Автохимия (77)
11. Витамины и БАД (86)
12. Шины и диски (88)

### Supabase credentials:
```
URL: https://rbngpxwamfkunktxjtqh.supabase.co
API Key: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJibmdweHdhbWZrdW5rdHhqdHFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1OTk5NDcsImV4cCI6MjA2NDE3NTk0N30.cpW1S5MK7eOfYSZx9gHP_AP-wH5BRIigUFwlBYNA2MI
```

### Как получить актуальные ID категорий:
```bash
SUPABASE_URL="https://rbngpxwamfkunktxjtqh.supabase.co"
SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJibmdweHdhbWZrdW5rdHhqdHFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg1OTk5NDcsImV4cCI6MjA2NDE3NTk0N30.cpW1S5MK7eOfYSZx9gHP_AP-wH5BRIigUFwlBYNA2MI"

curl -s "$SUPABASE_URL/rest/v1/categories?select=id,name,product_count&order=product_count.asc" \
  -H "apikey: $SUPABASE_KEY" -H "Authorization: Bearer $SUPABASE_KEY"
```

### Как получить товары категории:
```bash
curl -s "$SUPABASE_URL/rest/v1/products?select=id,name&category_id=eq.{CATEGORY_ID}&order=name&limit=100" \
  -H "apikey: $SUPABASE_KEY" -H "Authorization: Bearer $SUPABASE_KEY"
```

### Алгоритм перепроверки:

#### ШАГ 1: Запусти агента для аудита
Используй Task tool с subagent_type='general-purpose':

```
Ты аудитор каталога. ПЕРЕПРОВЕРЬ релевантность товаров в категориях.
Предыдущий агент уже проверял эти категории - найди ЕГО ОШИБКИ.

**Подключение:**
URL: https://rbngpxwamfkunktxjtqh.supabase.co
API Key: [ключ]

**Категории для ПЕРЕПРОВЕРКИ:**
[список с ID - получи сначала актуальные ID!]

**Задача:**
1. Получи ВСЕ товары каждой категории через curl
2. Проанализируй КАЖДЫЙ товар - соответствует ли он категории
3. Ищи:
   - Товары которые НЕ соответствуют категории
   - Книги в неправильных местах
   - Электронику не там где надо
   - Инструменты разбросанные по другим категориям

**Формат отчёта:**
КАТЕГОРИЯ: [название]
Всего: X | Проблемных: Y

НАЙДЕННЫЕ ПРОБЛЕМЫ:
| ID | Название | Текущая категория | Куда перенести |
|---|---|---|---|
| реальный-uuid | название товара | откуда | куда |

**КРИТИЧНО:**
- Копируй ID ТОЧНО из ответа API!
- НЕ выдумывай товары!
- Проверяй ВСЕ товары, не только первые 20
```

#### ШАГ 2: ОБЯЗАТЕЛЬНО проверь ID
Агенты часто ВЫДУМЫВАЮТ ID! Проверь каждый:
```bash
curl -s "$SUPABASE_URL/rest/v1/products?id=eq.{ID}&select=id,name,category_id" \
  -H "apikey: $SUPABASE_KEY" -H "Authorization: Bearer $SUPABASE_KEY"
```

#### ШАГ 3: Исправь найденные проблемы
Только после проверки ID! Создай скрипт:

```javascript
const SUPABASE_URL = 'https://rbngpxwamfkunktxjtqh.supabase.co';
const SUPABASE_KEY = '...';

const MOVES = [
  { id: 'проверенный-uuid', to: 'целевая_категория_id' },
];

async function moveProduct(id, newCategoryId) {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/products?id=eq.${id}`, {
    method: 'PATCH',
    headers: {
      'apikey': SUPABASE_KEY,
      'Authorization': `Bearer ${SUPABASE_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ category_id: newCategoryId })
  });
  return res.ok;
}
```

#### ШАГ 4: Обнови счётчики
Запусти существующий скрипт:
```bash
node check-counters.js
```

### Целевые категории для перемещения:
| Категория | ID |
|-----------|-----|
| Профессиональная литература | 935d68e2-9ee6-4e90-8c37-f46bb5fd25f6 |
| Инструменты | 761a23b9-9a65-49ec-922d-8db58b9fcce9 |
| Электрика | b06d205d-3f25-4c61-8037-fcf706aa70f9 |
| Умный дом | 2292b403-4a9e-4372-8dd7-75a33c9dc85e |
| Косметика | d9426962-6ca6-4187-99dd-0bd0ca88651e |
| Мебель | 00000066-0000-0000-0000-000000660000 |
| Электроника общего назначения | 52b329e8-5fbf-4e77-83a2-62d55e5671d6 |
| Хозяйственные товары | 4e53a812-6edb-482f-8ea1-b9150215c169 |
| Декор | 8297422c-1ca9-432f-b966-4168458aa5c7 |
| Уход за кожей | c90531a8-0a92-4ece-98a1-1e97489c063f |
| Спальня | 321e45c7-a9ad-4ec8-b900-74fbe75afcd0 |
| Станки и оборудование | ecca7d11-cc0d-441d-83eb-c8318c48feb3 |

### На что обращать внимание (типичные ошибки):
- **Книги** - слова "продукт", "гигиена", "здоровье", "витамин" в названии
- **Мыши/клавиатуры** - попадают в "Смартфоны"
- **Косметика** - попадает в "Витамины"
- **Электрика** - слово "socket" засоряет другие категории
- **Инструменты** - разбросаны везде
- **Мебель** - попадает в "Текстиль"
- **Товары для животных** - попадают в "Витамины"

### ВАЖНО:
1. **АГЕНТЫ ВЫДУМЫВАЮТ ID** - проверяй каждый перед исправлением!
2. Работай батчами по 3-4 категории
3. Сначала получи актуальные ID категорий
4. В конце проверь счётчики

### Полезные скрипты в проекте:
- `check-counters.js` - проверка счётчиков категорий
- `fix-categories.js` - пример скрипта исправления

### Начни:
1. Получи актуальный список категорий с ID через curl
2. Запусти агента для перепроверки первых 4 категорий
3. ПРОВЕРЬ что ID реальные
4. Исправь найденные проблемы
5. Повтори для остальных категорий
